/*!
 * mokuji.js v1.4.0
 * https://github.com/hiro0218/mokuji.js
 * 
 * Copyright (C) 2017-2018 hiro
 */
!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.Mokuji=r():e.Mokuji=r()}("undefined"!=typeof self?self:this,function(){return function(e){function r(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var n={};return r.m=e,r.c=n,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:t})},r.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=0)}([function(e,r,n){"use strict";function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0}),r.init=undefined;var o=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},a=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),i=n(1),u=function(e){return e&&e.__esModule?e:{default:e}}(i),c={anchorType:!0,anchorLink:!1,anchorLinkSymbol:"#",anchorLinkBefore:!0,anchorLinkClassName:""},l=[];r.init=function(){function e(r,n){if(t(this,e),r){n=o(c,n);var a=this.render(r,n);return l=[],a}}return a(e,[{key:"render",value:function(e,r){var n=this.generateMokuji(e,r);return r.anchorLink&&this.renderAnchorLink(n,r),n}},{key:"generateMokuji",value:function(e,r){for(var n=this.createHeadingWalker(e),t=null,o=0,a=document.createElement("ol"),i=document.createElement("li"),c=document.createElement("a");t=n.nextNode();){var l=t.tagName.match(/\d/g).join("");if(l=Number(l),0!==o&&o<l){var f=document.createElement("ol");a.lastChild.appendChild(f),a=f}else if(0!==o&&o>l)for(var d=0;d<o-l;d++)(0,u["default"])(a,a.parentNode)&&(a=a.parentNode.parentNode);var s=this.censorshipId(t.textContent);t.id=this.setAnchor(t.id,s,r.anchorType),a.appendChild(this.buildList(t,c.cloneNode(!1),i.cloneNode(!1))),o=l}return 0===o?null:(a=this.reverseMokuji(a),this.removeDuplicateIds(a),a)}},{key:"censorshipId",value:function(e){var r=e,n=1;if(-1!==l.indexOf(r))for(;n<10;){var t=r+"_"+n;if(-1===l.indexOf(t)){r=t,l.push(r);break}n++}else l.push(r);return r}},{key:"createHeadingWalker",value:function(e){return document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,function(e){return/^H[1-6]$/.test(e.tagName)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP},!1)}},{key:"setAnchor",value:function(e,r,n){var t=e||this.replaceSpace2Underscore(r);return t=t.replace(/\&+/g,""),t=t.replace(/\&amp;+/g,""),!0===n&&(t=encodeURIComponent(t),t=t.replace(/\%+/g,".")),t}},{key:"renderAnchorLink",value:function(e,r){if(e){var n=e.getElementsByTagName("a"),t=document.createElement("a");t.classList.add(r.anchorLinkClassName);for(var o=0;o<n.length;o++){var a=n[o].hash,i=document.querySelector('[id="'+a.replace("#","")+'"]');if(i){var u=t.cloneNode(!1);u.setAttribute("href",a),u.textContent=r.anchorLinkSymbol,r.anchorLinkBefore?i.insertBefore(u,i.firstChild):i.appendChild(u)}}}}},{key:"replaceSpace2Underscore",value:function(e){return String(e).replace(/\s+/g,"_")}},{key:"buildList",value:function(e,r,n){return r.href="#"+e.id,r.textContent=e.textContent,n.appendChild(r),n}},{key:"reverseMokuji",value:function(e){for(;e.parentNode;)e=e.parentNode;return e}},{key:"removeDuplicateIds",value:function(e){for(var r=e.getElementsByTagName("a"),n=0;n<r.length;n++){var t=r[n].innerText,o=r[n].hash,a=document.querySelectorAll('[id="'+t+'"]');if(1!==a.length){var i=0;Array.from||(Array.from=function(e){return Array.prototype.slice.call(e)});for(var u=Array.from(a),c=Array.isArray(u),l=0,u=c?u:u[Symbol.iterator]();;){var f;if(c){if(l>=u.length)break;f=u[l++]}else{if(l=u.next(),l.done)break;f=l.value}for(var d=f,s=d.id+"-"+i,p=Array.from(r),h=Array.isArray(p),v=0,p=h?p:p[Symbol.iterator]();;){var y;if(h){if(v>=p.length)break;y=p[v++]}else{if(v=p.next(),v.done)break;y=v.value}var m=y;if(m.hash===o){m.href="#"+s;break}}d.id=s,i++}}}}}]),e}()},function(e,r,n){"use strict";function t(e,r){for(;e;){if(e===r)return!0;e=e.parentNode}return!1}Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=t}])});