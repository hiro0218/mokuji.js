/*!
 * mokuji.js v1.4.2
 * https://github.com/hiro0218/mokuji.js
 * 
 * Copyright (C) 2017-2018 hiro
 */
!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.Mokuji=r():e.Mokuji=r()}("undefined"!=typeof self?self:this,function(){return function(e){function r(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var n={};return r.m=e,r.c=n,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:t})},r.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=0)}([function(e,r,n){"use strict";function t(e,r){for(;e;){if(e===r)return!0;e=e.parentNode}return!1}function o(){return o=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},o.apply(this,arguments)}function a(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function i(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function c(e,r,n){return r&&i(e.prototype,r),n&&i(e,n),e}Object.defineProperty(r,"__esModule",{value:!0}),n.d(r,"init",function(){return f});var u={anchorType:!0,anchorLink:!1,anchorLinkSymbol:"#",anchorLinkBefore:!0,anchorLinkClassName:""},l=[],f=function(){function e(r,n){if(a(this,e),r){n=o(u,n);var t=this.render(r,n);return l=[],t}}return c(e,[{key:"render",value:function(e,r){var n=this.generateMokuji(e,r);return r.anchorLink&&this.renderAnchorLink(n,r),n}},{key:"generateMokuji",value:function(e,r){for(var n=this.createHeadingWalker(e),o=null,a=0,i=document.createElement("ol"),c=document.createElement("li"),u=document.createElement("a");o=n.nextNode();){var l=o.tagName.match(/\d/g).join("");if(l=Number(l),0!==a&&a<l){var f=document.createElement("ol");i.lastChild.appendChild(f),i=f}else if(0!==a&&a>l)for(var d=0;d<a-l;d++)t(i,i.parentNode)&&(i=i.parentNode.parentNode);var s=this.censorshipId(o.textContent);o.id=this.setAnchor(o.id,s,r.anchorType),i.appendChild(this.buildList(o,u.cloneNode(!1),c.cloneNode(!1))),a=l}return 0===a?null:(i=this.reverseMokuji(i),this.removeDuplicateIds(i),i)}},{key:"censorshipId",value:function(e){var r=e,n=1;if(-1!==l.indexOf(r))for(;n<10;){var t="".concat(r,"_").concat(n);if(-1===l.indexOf(t)){r=t,l.push(r);break}n++}else l.push(r);return r}},{key:"createHeadingWalker",value:function(e){return document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,function(e){return/^H[1-6]$/.test(e.tagName)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP},!1)}},{key:"setAnchor",value:function(e,r,n){var t=e||this.replaceSpace2Underscore(r);return t=t.replace(/\&+/g,""),t=t.replace(/\&amp;+/g,""),!0===n&&(t=encodeURIComponent(t),t=t.replace(/\%+/g,".")),t}},{key:"renderAnchorLink",value:function(e,r){if(e){var n=e.getElementsByTagName("a"),t=document.createElement("a");t.classList.add(r.anchorLinkClassName);for(var o=0;o<n.length;o++){var a=n[o].hash,i=document.querySelector('[id="'.concat(a.replace("#",""),'"]'));if(i){var c=t.cloneNode(!1);c.setAttribute("href",a),c.textContent=r.anchorLinkSymbol,r.anchorLinkBefore?i.insertBefore(c,i.firstChild):i.appendChild(c)}}}}},{key:"replaceSpace2Underscore",value:function(e){return String(e).replace(/\s+/g,"_")}},{key:"buildList",value:function(e,r,n){return r.href="#"+e.id,r.textContent=e.textContent,n.appendChild(r),n}},{key:"reverseMokuji",value:function(e){for(;e.parentNode;)e=e.parentNode;return e}},{key:"removeDuplicateIds",value:function(e){for(var r=e.getElementsByTagName("a"),n=0;n<r.length;n++){var t=r[n].innerText,o=r[n].hash,a=document.querySelectorAll('[id="'.concat(t,'"]'));if(1!==a.length){var i=0;Array.from||(Array.from=function(e){return Array.prototype.slice.call(e)});for(var c=Array.from(a),u=0;u<c.length;u++){for(var l=c[u],f="".concat(l.id,"-").concat(i),d=Array.from(r),s=0;s<d.length;s++){var p=d[s];if(p.hash===o){p.href="#".concat(f);break}}l.id=f,i++}}}}}]),e}()}])});