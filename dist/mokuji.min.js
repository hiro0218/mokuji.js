/*!
 * mokuji.js v1.3.4
 * https://github.com/hiro0218/mokuji.js
 * 
 * Copyright (C) 2017 hiro
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Mokuji=t():e.Mokuji=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};return t.m=e,t.c=o,t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var o=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,o){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.init=undefined;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},l=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}(),i=o(1),a=function(e){return e&&e.__esModule?e:{default:e}}(i);o(2).polyfill();var c={anchorType:"",anchorLink:!1,anchorLinkSymbol:"#",anchorLinkBefore:!0,anchorLinkClassName:"",smoothScroll:!0};t.init=function(){function e(t,o){if(r(this,e),t){o=n(c,o);return this.render(t,o)}}return l(e,[{key:"render",value:function(e,t){var o=this.generateMokuji(e,t);if(o)return t.anchorLink&&this.renderAnchorLink(o,t),t.smoothScroll&&this.setSmoothScroll(o),o}},{key:"generateMokuji",value:function(e,t){for(var o=this.createHeadingWalker(e),r=null,n=0,l=document.createElement("ol"),i=document.createElement("li"),c=document.createElement("a");r=o.nextNode();){var f=r.tagName.match(/\d/g).join("");if(f=Number(f),0!==n&&n<f){var u=document.createElement("ol");l.lastChild.appendChild(u),l=u}else if(0!==n&&n>f)for(var s=0;s<n-f;s++)(0,a["default"])(l,l.parentNode)&&(l=l.parentNode.parentNode);r.id=this.setAnchor(r.id,r.textContent,t.anchorType),l.appendChild(this.buildList(r,c.cloneNode(!1),i.cloneNode(!1))),n=f}return 0===n?null:(l=this.reverseMokuji(l),this.removeDuplicateIds(l),l)}},{key:"createHeadingWalker",value:function(e){return document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,function(e){return/^H[1-6]$/.test(e.tagName)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP},!1)}},{key:"setAnchor",value:function(e,t,o){var r=e||this.replaceSpace2Underscore(t);return r=r.replace(/\&+/g,""),r=r.replace(/\&amp;+/g,""),"wikipedia"===o&&(r=encodeURIComponent(r),r=r.replace(/\%+/g,".")),r}},{key:"renderAnchorLink",value:function(e,t){if(e){var o=e.getElementsByTagName("a"),r=document.createElement("a");r.classList.add(t.anchorLinkClassName);for(var n=0;n<o.length;n++){var l=o[n].hash,i=document.querySelector('[id="'+l.replace("#","")+'"]'),a=r.cloneNode(!1);a.setAttribute("href",l),a.textContent=t.anchorLinkSymbol,t.anchorLinkBefore?i.insertBefore(a,i.firstChild):i.appendChild(a)}}}},{key:"setSmoothScroll",value:function(e){if(e)for(var t=e.getElementsByTagName("a"),o=0;o<t.length;o++)t[o].addEventListener("click",function(e){var t=this.hash;e.preventDefault(),document.querySelector('[id="'+t.replace("#","")+'"]').scrollIntoView({behavior:"smooth"}),history.pushState(null,null,t)})}},{key:"replaceSpace2Underscore",value:function(e){return String(e).replace(/\s+/g,"_")}},{key:"buildList",value:function(e,t,o){return t.href="#"+e.id,t.textContent=e.textContent,o.appendChild(t),o}},{key:"reverseMokuji",value:function(e){for(;e.parentNode;)e=e.parentNode;return e}},{key:"removeDuplicateIds",value:function(e){for(var t=e.getElementsByTagName("a"),o=0;o<t.length;o++){var r=t[o].innerText,n=t[o].hash,l=document.querySelectorAll('[id="'+r+'"]');if(1!==l.length){var i=0;Array.from||(Array.from=function(e){return Array.prototype.slice.call(e)});for(var a=Array.from(l),c=Array.isArray(a),f=0,a=c?a:a[Symbol.iterator]();;){var u;if(c){if(f>=a.length)break;u=a[f++]}else{if(f=a.next(),f.done)break;u=f.value}for(var s=u,d=s.id+"-"+i,p=Array.from(t),h=Array.isArray(p),v=0,p=h?p:p[Symbol.iterator]();;){var y;if(h){if(v>=p.length)break;y=p[v++]}else{if(v=p.next(),v.done)break;y=v.value}var m=y;if(m.hash===n){m.href="#"+d;break}}s.id=d,i++}}}}}]),e}()},function(e,t,o){"use strict";e.exports=function(e,t){for(;e;){if(e===t)return!0;e=e.parentNode}return!1}},function(e,t,o){!function(){"use strict";function t(e){var t=["MSIE ","Trident/","Edge/"];return new RegExp(t.join("|")).test(e)}function o(){function e(e,t){this.scrollLeft=e,this.scrollTop=t}function o(e){return.5*(1-Math.cos(Math.PI*e))}function l(e){if(null===e||"object"!=typeof e||e.behavior===undefined||"auto"===e.behavior||"instant"===e.behavior)return!0;if("object"==typeof e&&"smooth"===e.behavior)return!1;throw new TypeError("behavior member of ScrollOptions "+e.behavior+" is not a valid value for enumeration ScrollBehavior.")}function i(e,t){return"Y"===t?e.clientHeight+h<e.scrollHeight:"X"===t?e.clientWidth+h<e.scrollWidth:void 0}function a(e,t){var o=r.getComputedStyle(e,null)["overflow"+t];return"auto"===o||"scroll"===o}function c(e){var t=i(e,"Y")&&a(e,"Y"),o=i(e,"X")&&a(e,"X");return t||o}function f(e){var t;do{e=e.parentNode,t=e===n.body}while(!1===t&&!1===c(e));return t=null,e}function u(e){var t,n,l,i=y(),a=(i-e.startTime)/p;a=a>1?1:a,t=o(a),n=e.startX+(e.x-e.startX)*t,l=e.startY+(e.y-e.startY)*t,e.method.call(e.scrollable,n,l),n===e.x&&l===e.y||r.requestAnimationFrame(u.bind(r,e))}function s(t,o,l){var i,a,c,f,s=y();t===n.body?(i=r,a=r.scrollX||r.pageXOffset,c=r.scrollY||r.pageYOffset,f=v.scroll):(i=t,a=t.scrollLeft,c=t.scrollTop,f=e),u({scrollable:i,method:f,startTime:s,startX:a,startY:c,x:o,y:l})}if(!("scrollBehavior"in n.documentElement.style&&!0!==r.__forceSmoothScrollPolyfill__)){var d=r.HTMLElement||r.Element,p=468,h=t(r.navigator.userAgent)?1:0,v={scroll:r.scroll||r.scrollTo,scrollBy:r.scrollBy,elementScroll:d.prototype.scroll||e,scrollIntoView:d.prototype.scrollIntoView},y=r.performance&&r.performance.now?r.performance.now.bind(r.performance):Date.now;r.scroll=r.scrollTo=function(){if(arguments[0]!==undefined)return!0===l(arguments[0])?void v.scroll.call(r,arguments[0].left!==undefined?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:r.scrollX||r.pageXOffset,arguments[0].top!==undefined?arguments[0].top:arguments[1]!==undefined?arguments[1]:r.scrollY||r.pageYOffset):void s.call(r,n.body,arguments[0].left!==undefined?~~arguments[0].left:r.scrollX||r.pageXOffset,arguments[0].top!==undefined?~~arguments[0].top:r.scrollY||r.pageYOffset)},r.scrollBy=function(){if(arguments[0]!==undefined)return l(arguments[0])?void v.scrollBy.call(r,arguments[0].left!==undefined?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:0,arguments[0].top!==undefined?arguments[0].top:arguments[1]!==undefined?arguments[1]:0):void s.call(r,n.body,~~arguments[0].left+(r.scrollX||r.pageXOffset),~~arguments[0].top+(r.scrollY||r.pageYOffset))},d.prototype.scroll=d.prototype.scrollTo=function(){if(arguments[0]!==undefined){if(!0===l(arguments[0])){if("number"==typeof arguments[0]&&arguments[1]===undefined)throw new SyntaxError("Value couldn't be converted");return void v.elementScroll.call(this,arguments[0].left!==undefined?~~arguments[0].left:"object"!=typeof arguments[0]?~~arguments[0]:this.scrollLeft,arguments[0].top!==undefined?~~arguments[0].top:arguments[1]!==undefined?~~arguments[1]:this.scrollTop)}var e=arguments[0].left,t=arguments[0].top;s.call(this,this,void 0===e?this.scrollLeft:~~e,void 0===t?this.scrollTop:~~t)}},d.prototype.scrollBy=function(){if(arguments[0]!==undefined)return!0===l(arguments[0])?void v.elementScroll.call(this,arguments[0].left!==undefined?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,arguments[0].top!==undefined?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop):void this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior})},d.prototype.scrollIntoView=function(){if(!0===l(arguments[0]))return void v.scrollIntoView.call(this,arguments[0]===undefined||arguments[0]);var e=f(this),t=e.getBoundingClientRect(),o=this.getBoundingClientRect();e!==n.body?(s.call(this,e,e.scrollLeft+o.left-t.left,e.scrollTop+o.top-t.top),"fixed"!==r.getComputedStyle(e).position&&r.scrollBy({left:t.left,top:t.top,behavior:"smooth"})):r.scrollBy({left:o.left,top:o.top,behavior:"smooth"})}}}var r=window,n=document;e.exports={polyfill:o}}()}])});